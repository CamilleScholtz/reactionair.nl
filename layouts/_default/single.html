{{ define "main" }}
	<article>
		<section class="hero">
			<div class="left">
				{{ $image := .Resources.GetMatch .Params.image }}

				{{ $1x := $image.Resize "x1024 webp" }}
				{{ $2x := $image.Resize "x2048 webp" }}

				<figure>
					<img 
						srcset="{{ $1x.RelPermalink }} 1x,
						        {{ $2x.RelPermalink }} 2x"
						src="{{ $2x.RelPermalink }}"
						alt="{{ if isset .Params "caption" }}{{ .Params.caption }}{{ else }}{{ .Params.title | safeHTML }}{{ end }}"
						style="background: {{ index $1x.Colors 0 }};">

					{{ if isset .Params "caption" }}
						<figcaption>{{ .Params.caption }}</figcaption>
					{{ end }}
				</figure>
			</div>

			<div class="right">
				<div class="authors">
					{{ range $index, $author := .Params.authors }}
						<a href="/auteurs/{{ urlize $author }}">{{ $author }}</a>{{ if ne (add $index 1) (len $.Params.authors) }},&nbsp{{ end }}
					{{ end }}
				</div>

				{{ if isset .Params "note" }}
					<section class="note">
						<small>{{ .Params.note | markdownify }}</small>
					</section>
				{{ end }}

				<h1>{{ .Params.title | safeHTML }}</h1>
				<h2>{{ .Params.subtitle | safeHTML }}</h2>
			</div>
		</section>

		<section class="content">		
			{{ .Content }}

			{{ if isset .Params "cited" }}
				<section class="cited">
					<p>Aangehaald in dit artikel:</p>

					{{ range .Params.cited }}
						<a href="/aangehaald/{{ urlize . }}">{{ . }}</a>
					{{ end }}
				</section>
			{{ end }}
		</section>
	</article>

	{{ if isset .Params "files" }}
		<section class="files">
			{{ range $i, $file := .Params.files }}
				{{ $pages    := where site.RegularPages "Params.files" "intersect" (slice $file) }}
				{{ $pages     = where $pages "Params.title" "ne" $.Params.title }}
				{{ $pages     = first 5 $pages }}

				{{ $side := "left" }}
				{{ if mod $i 2 }}
					{{ $side = "right" }}
				{{ end }}

				{{ partialCached "articles/theme.html" (dict
					"context" .
					"section" "files"
					"path"    "dossiers"
					"term"    $file
					"pages"   $pages
					"side"    $side
					"lazy"    true
				) "files" $file $pages $side }}
			{{ end }}
		</section>
	{{ end }}

	<section id="comments">
		{{ partial "comments/comments" . }}
	</section>
{{ end }}
